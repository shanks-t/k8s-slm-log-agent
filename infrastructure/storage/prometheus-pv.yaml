---
# PersistentVolume for Prometheus on Node 2
# This defines a volume that points to the Samsung NVMe storage
apiVersion: v1
kind: PersistentVolume
metadata:
  name: prometheus-pv
  labels:
    app: prometheus
    type: local
spec:
  # Storage capacity - 50GB allocated for Prometheus metrics
  # Time-series data with 15-day retention should use <20GB in practice
  # 50GB provides headroom for growth
  capacity:
    storage: 50Gi

  # Access mode: ReadWriteOnce means one pod can mount it
  # Perfect for single-replica Prometheus
  accessModes:
    - ReadWriteOnce

  # persistentVolumeReclaimPolicy determines what happens when PVC is deleted
  # Retain = keep the data even if PVC is deleted (safe for production)
  persistentVolumeReclaimPolicy: Retain

  # storageClassName must match the PVC below
  storageClassName: local-storage

  # local volume type - directly uses host filesystem
  local:
    path: /mnt/k8s-storage/prometheus

  # nodeAffinity ensures this PV is only used on Node 2
  # Critical: This ties the PV to the physical node with the Samsung NVMe
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - node-2  # Node 2's hostname
