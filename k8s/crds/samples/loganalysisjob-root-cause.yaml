apiVersion: intelligence.homelab.io/v1alpha1
kind: LogAnalysisJob
metadata:
  name: analyze-pod-crashes
  namespace: default
  labels:
    analysisType: root-cause
    severity: high
spec:
  # Time range for log query
  timeRange:
    start: "2025-12-14T10:00:00Z"
    duration: "1h"

  # Filter by namespace
  namespace: "default"

  # Filter by severity levels
  severity:
    - ERROR
    - CRITICAL

  # Type of analysis to perform
  analysisType: root-cause

  # LLM configuration
  llmModel: "llama-3.2-3b"
  maxTokens: 512
  temperature: 0.3

---
apiVersion: intelligence.homelab.io/v1alpha1
kind: LogAnalysisJob
metadata:
  name: analyze-loki-errors
  namespace: logging
  labels:
    analysisType: root-cause
    target: loki
spec:
  timeRange:
    start: "2025-12-14T12:00:00Z"
    duration: "30m"

  namespace: "logging"

  # Use pod selector to target specific pods
  podSelector:
    app.kubernetes.io/name: loki

  severity:
    - ERROR

  analysisType: root-cause

  llmModel: "llama-3.2-3b"
  maxTokens: 256
  temperature: 0.2

---
apiVersion: intelligence.homelab.io/v1alpha1
kind: LogAnalysisJob
metadata:
  name: custom-loki-query
  namespace: default
spec:
  timeRange:
    start: "2025-12-14T09:00:00Z"
    duration: "2h"

  # Custom LogQL query (overrides other filters)
  lokiQuery: '{namespace="llm",container="llama-cpp"} |= "error" | json | severity="ERROR"'

  analysisType: summary

  llmModel: "llama-3.2-3b"
  maxTokens: 512
  temperature: 0.5
