apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: goldenlogsamples.intelligence.homelab.io
  annotations:
    controller-gen.kubebuilder.io/version: "manual"
spec:
  group: intelligence.homelab.io
  scope: Namespaced
  names:
    plural: goldenlogsamples
    singular: goldenlogsample
    kind: GoldenLogSample
    shortNames:
      - gls
      - goldensample
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          description: "GoldenLogSample represents a labeled log entry for evaluation and testing"
          properties:
            apiVersion:
              type: string
              description: "APIVersion defines the versioned schema of this representation of an object"
            kind:
              type: string
              description: "Kind is a string value representing the REST resource this object represents"
            metadata:
              type: object
            spec:
              type: object
              description: "Spec defines the log sample and its ground truth labels"
              required:
                - logEntry
                - groundTruth
              properties:
                logEntry:
                  type: string
                  description: "Raw log entry (JSON or plain text)"
                  example: '{"level":"error","pod":"myapp-6d5f8-abc","msg":"OOMKilled: container exceeded memory limit"}'
                context:
                  type: object
                  description: "Additional context about the log"
                  properties:
                    timestamp:
                      type: string
                      format: date-time
                      description: "Original log timestamp"
                    namespace:
                      type: string
                      description: "Kubernetes namespace"
                    pod:
                      type: string
                      description: "Pod name"
                    container:
                      type: string
                      description: "Container name"
                    node:
                      type: string
                      description: "Node name"
                    cluster:
                      type: string
                      description: "Cluster name"
                      default: "homelab"
                groundTruth:
                  type: object
                  description: "Ground truth labels for evaluation"
                  required:
                    - rootCause
                    - severity
                    - component
                  properties:
                    rootCause:
                      type: string
                      description: "Expected root cause identification"
                      example: "memory-limit-exceeded"
                    severity:
                      type: string
                      description: "Expected severity classification"
                      enum:
                        - INFO
                        - WARN
                        - ERROR
                        - CRITICAL
                      example: "CRITICAL"
                    component:
                      type: string
                      description: "Expected component identification"
                      example: "pod-lifecycle"
                    summary:
                      type: string
                      description: "Expected human-readable summary"
                      example: "Pod terminated due to memory limit exceeded (OOMKilled)"
                    recommendedAction:
                      type: string
                      description: "Expected recommended action"
                      example: "increase-memory-limits"
                    tags:
                      type: array
                      description: "Classification tags"
                      items:
                        type: string
                      example: ["oom", "resource-limit", "pod-failure"]
                category:
                  type: string
                  description: "Sample category for dataset stratification"
                  enum:
                    - infra-pod-failure
                    - infra-network-error
                    - infra-storage-issue
                    - infra-scheduling-error
                    - app-crash
                    - app-error
                    - app-warning
                    - app-info
                  example: "infra-pod-failure"
                source:
                  type: string
                  description: "Source of this sample"
                  enum:
                    - real
                    - synthetic
                    - curated
                  default: "real"
                difficulty:
                  type: string
                  description: "Difficulty level for evaluation"
                  enum:
                    - easy
                    - medium
                    - hard
                  default: "medium"
                notes:
                  type: string
                  description: "Additional notes about this sample"
            status:
              type: object
              description: "Status tracks evaluation results for this sample"
              properties:
                lastEvaluated:
                  type: string
                  format: date-time
                  description: "Last evaluation timestamp"
                evaluationResults:
                  type: array
                  description: "History of evaluation results"
                  items:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                      modelVersion:
                        type: string
                      predicted:
                        type: object
                        properties:
                          rootCause:
                            type: string
                          severity:
                            type: string
                          component:
                            type: string
                          summary:
                            type: string
                      accuracy:
                        type: object
                        description: "Per-field accuracy scores"
                        properties:
                          rootCauseMatch:
                            type: boolean
                          severityMatch:
                            type: boolean
                          componentMatch:
                            type: boolean
                          overallScore:
                            type: number
                            minimum: 0.0
                            maximum: 1.0
                successRate:
                  type: number
                  description: "Success rate across all evaluations (0.0-1.0)"
                  minimum: 0.0
                  maximum: 1.0
                totalEvaluations:
                  type: integer
                  description: "Total number of evaluations"
                  minimum: 0
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Severity
          type: string
          description: "Ground truth severity"
          jsonPath: .spec.groundTruth.severity
        - name: Category
          type: string
          description: "Sample category"
          jsonPath: .spec.category
        - name: Source
          type: string
          description: "Sample source"
          jsonPath: .spec.source
          priority: 1
        - name: Success Rate
          type: string
          description: "Evaluation success rate"
          jsonPath: .status.successRate
          priority: 1
        - name: Age
          type: date
          description: "Creation timestamp"
          jsonPath: .metadata.creationTimestamp
