# Loki Helm Chart Values
# Chart: grafana/loki (version 6.x)
# Deployment Mode: Monolithic (single pod, all components)

# Loki configuration
loki:
  # Authentication disabled for internal homelab use
  # In production, you'd enable this
  auth_enabled: false

  # Common configuration for all Loki components
  commonConfig:
    # Use filesystem for both chunks and index (simple, no object storage needed)
    replication_factor: 1

  # Storage configuration
  storage:
    type: filesystem  # Use local filesystem (our Samsung NVMe)

  # Schema configuration - defines how logs are indexed
  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb  # Time Series Database index (newer, more efficient than boltdb)
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h  # Create new index every 24 hours

  # Limits configuration - prevents runaway log ingestion
  limits_config:
    retention_period: 168h  # Keep logs for 7 days (1 week)
    max_query_length: 721h  # Allow querying up to 30 days
    ingestion_rate_mb: 50   # Max 50MB/s ingestion per stream
    ingestion_burst_size_mb: 100  # Allow bursts up to 100MB

  # Memberlist configuration - used for multi-instance coordination
  # In SingleBinary mode with 1 replica, memberlist isn't needed
  memberlist:
    join_members: []  # Empty list = don't join any cluster

# Deployment type: SingleBinary (monolithic mode)
deploymentMode: SingleBinary

# SingleBinary specific configuration
singleBinary:
  # Number of replicas - 1 is fine for homelab
  replicas: 1

  # Resource requests and limits
  # Start conservative, can increase based on actual usage
  resources:
    requests:
      cpu: 500m      # 0.5 CPU cores
      memory: 1Gi    # 1GB RAM
    limits:
      cpu: 2         # Max 2 CPU cores
      memory: 4Gi    # Max 4GB RAM

  # Persistent storage configuration
  persistence:
    enabled: true
    # Size of the PVC to create (must match our PV)
    size: 200Gi
    # Use our custom storage class that binds to the Samsung NVMe
    # This tells the StatefulSet to create a PVC with storageClassName: local-storage
    # which will bind to our pre-created loki-pv (the only PV with that storage class)
    storageClass: local-storage
    # Selector to ensure it binds to our specific PV
    selector:
      matchLabels:
        app: loki
        type: local

  # Node placement - ensure Loki runs on Node 2
  nodeSelector:
    hardware: heavy

  # Toleration for Node 2's taint
  tolerations:
    - key: heavy
      operator: Equal
      value: "true"
      effect: NoSchedule

  # Note: Volume mounts are handled automatically by the chart
  # when persistence.enabled=true and persistence.existingClaim is set

# Disable all caching components (not needed for homelab scale)
chunksCache:
  enabled: false

resultsCache:
  enabled: false

# Loki Canary - disabled (it's a top-level parameter, not under monitoring)
lokiCanary:
  enabled: false

# Monitoring configuration (for future Prometheus integration)
monitoring:
  selfMonitoring:
    enabled: false  # Disable for now, enable in later phase
    grafanaAgent:
      installOperator: false

# Gateway configuration (optional reverse proxy for Loki)
# Disabled for simplicity - we'll access Loki directly from Grafana
gateway:
  enabled: false

# Test pod configuration
# Disabled to save resources
test:
  enabled: false

# Backend configuration (not used in SingleBinary mode)
backend:
  replicas: 0

# Read/Write components (not used in SingleBinary mode)
read:
  replicas: 0

write:
  replicas: 0
