# Tempo Helm Chart Values
# Chart: grafana/tempo (version 1.x)
# Deployment Mode: Monolithic (single pod, StatefulSet)

# Number of replicas (1 for homelab)
replicas: 1

# Tempo-specific configuration
tempo:
  # Image configuration
  repository: grafana/tempo
  tag: ""  # Use chart's default version
  pullPolicy: IfNotPresent

  # Multi-tenancy disabled for homelab
  multitenancyEnabled: false

  # Metrics generator - disabled for now (enable when we add Prometheus)
  metricsGenerator:
    enabled: false

  # Storage configuration
  storage:
    trace:
      backend: local  # Use local filesystem (Samsung NVMe)
      local:
        path: /var/tempo/traces
      wal:
        path: /var/tempo/wal
      block:
        version: vParquet4  # Latest Parquet format

  # Retention period
  retention: 168h  # 7 days (matches Loki)

  # Overrides configuration - use legacy format
  overrides:
    per_tenant_override_config: /conf/overrides.yaml

  # Server configuration
  server:
    http_listen_port: 3200  # HTTP port for queries and UI

  # Distributor receivers configuration
  # Keep defaults - all receivers enabled (no harm in homelab)
  # We'll primarily use OTLP on ports 4317 (gRPC) and 4318 (HTTP)

  # Resource limits
  resources:
    requests:
      cpu: 500m      # 0.5 CPU cores
      memory: 512Mi  # 512MB RAM
    limits:
      cpu: 2         # Max 2 CPU cores
      memory: 2Gi    # Max 2GB RAM

# Persistence configuration
persistence:
  enabled: true
  # Use our pre-created PVC
  existingClaim: tempo-pvc
  accessModes:
    - ReadWriteOnce
  size: 50Gi

# Node placement - run on Node 2
nodeSelector:
  hardware: heavy

# Tolerations for Node 2's taint
tolerations:
  - key: heavy
    operator: Equal
    value: "true"
    effect: NoSchedule

# Service configuration
service:
  type: ClusterIP

# Ingress disabled (we'll use Envoy Gateway later if needed)
ingress:
  enabled: false

# Service Monitor for Prometheus (future phase)
serviceMonitor:
  enabled: false

# Gateway disabled (not needed for homelab)
gateway:
  enabled: false
